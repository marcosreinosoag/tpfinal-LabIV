<div class="admin-container">
  <!-- Navbar -->
  <nav class="navbar-clinica">
  <div class="logo">
    <img src="assets/images/icono.ico" alt="Cl√≠nica" />
    <div class="titulo-logo">
      <h2>Cl√≠nica OnLine</h2>
      <span>Especialistas en Salud</span>
    </div>
  </div>
<ul class="navbar-links">
    <li><button (click)="goTo('admin')">Usuarios</button></li>
    <li><button (click)="goTo('solicitar-turno-admin')">Solicitar Turno</button></li>
    <li><button (click)="goTo('registro')">Registrar usuario</button></li>
    <li><button (click)="goTo('turnos')">Turnos</button></li>
  <li><button class="logout-btn" (click)="logout()">Cerrar sesi√≥n</button></li>
</ul>
</nav>
<h2 class="titulo-informes">Todos los Informes</h2>

<div class="tabs-dashboard">
  <button 
    [class.activa]="seccionActiva === 'logs'" 
    (click)="cambiarSeccion('logs')">Logs</button>

  <button 
    [class.activa]="seccionActiva === 'especialidad'" 
    (click)="cambiarSeccion('especialidad')">Turnos por Especialidad</button>

  <button 
    [class.activa]="seccionActiva === 'dia'" 
    (click)="cambiarSeccion('dia')">Turnos por D√≠a</button>

     <button [class.activa]="seccionActiva === 'medico'" 
     (click)="cambiarSeccion('medico')">Turnos por M√©dico</button>
     <button 
  [class.activa]="seccionActiva === 'finalizados'" 
  (click)="cambiarSeccion('finalizados')">Turnos Finalizados</button>

  <button 
    [class.activa]="seccionActiva === 'visitas'" 
    (click)="cambiarSeccion('visitas')">Cantidad de Visitas</button>

  <button 
    [class.activa]="seccionActiva === 'pacientes-esp'" 
    (click)="cambiarSeccion('pacientes-esp')">Pacientes por Especialidad</button>

  <button 
    [class.activa]="seccionActiva === 'medicos-esp'" 
    (click)="cambiarSeccion('medicos-esp')">M√©dicos por Especialidad</button>

  <button 
    [class.activa]="seccionActiva === 'encuestas'" 
    (click)="cambiarSeccion('encuestas')">Encuestas de Satisfacci√≥n</button>

  <button 
    [class.activa]="seccionActiva === 'turnos-paciente'" 
    (click)="cambiarSeccion('turnos-paciente')">Turnos por Paciente</button>

</div>

<!-- LOGS -->
<div *ngIf="seccionActiva === 'logs'" class="seccion">
  <div class="logs-container">
    <div class="log-card" *ngFor="let log of logs">
      <p><strong>Email:</strong> {{ log.email }}</p>
      <p><strong>Fecha:</strong> {{ log.fecha | date:'dd/MM/yyyy' }}</p>
      <p><strong>Hora:</strong> {{ log.fecha | date:'hh:mm a' }}</p>
    </div>
  </div>
  <div class="exportar">
    <button (click)="exportToExcel()">EXPORTAR A EXCEL</button>
  </div>
</div>

<!-- GRAFICO ESPECIALIDAD -->
<div *ngIf="seccionActiva === 'especialidad'" class="seccion">
  <div class="grafico-contenedor">
    <canvas id="graficoTurnosEspecialidad"></canvas>
  </div>
  <div class="exportar">
    <button (click)="exportarGraficoAPdf()">EXPORTAR A PDF</button>
  </div>
</div>

<!-- GRAFICO D√çA -->
<div *ngIf="seccionActiva === 'dia'" class="seccion">
  <div class="grafico-contenedor">
    <canvas id="graficoTurnosDia"></canvas>
  </div>
  <div class="exportar">
    <button (click)="exportarGraficoPorDiaAPdf()">EXPORTAR A PDF</button>
  </div>
</div>

<!-- GRAFICO M√âDICO -->
<div *ngIf="seccionActiva === 'medico'" class="seccion">
  <div class="filtros-fecha">
    <label>Desde: <input type="date" [(ngModel)]="fechaDesde"></label>
    <label>Hasta: <input type="date" [(ngModel)]="fechaHasta"></label>
    <button (click)="filtrarTurnosPorMedico()">Filtrar</button>
  </div>

  <!-- Mostrar si hay datos -->
<div class="grafico-contenedor" *ngIf="turnosPorMedico.length > 0">
  <canvas id="graficoTurnosPorMedico"></canvas>
</div>


  <!-- Mensaje si no hay datos -->
  <div class="grafico-contenedor" *ngIf="turnosPorMedico.length === 0 && fechaDesde && fechaHasta">
    <p style="text-align: center; margin-top: 2rem;">No hay turnos registrados en ese per√≠odo.</p>
  </div>

  <div class="exportar" *ngIf="turnosPorMedico.length > 0">
    <button (click)="exportarGraficoPorMedicoAPdf()">EXPORTAR A PDF</button>
  </div>
</div>

<div *ngIf="seccionActiva === 'finalizados'" class="seccion">
  <div class="filtros-fecha">
    <label>Desde: <input type="date" [(ngModel)]="fechaDesdeFinalizados"></label>
    <label>Hasta: <input type="date" [(ngModel)]="fechaHastaFinalizados"></label>
    <button (click)="filtrarTurnosFinalizadosPorMedico()">Filtrar</button>
  </div>

  <div class="grafico-contenedor" *ngIf="turnosFinalizadosPorMedico.length > 0">
    <canvas id="graficoFinalizadosPorMedico"></canvas>
  </div>

  <div class="mensaje-vacio" *ngIf="turnosFinalizadosPorMedico.length === 0">
    No hay turnos finalizados en ese per√≠odo.
  </div>
  <div class="exportar" *ngIf="turnosFinalizadosPorMedico.length > 0">
  <button (click)="exportarGraficoFinalizadosPorMedicoAPdf()">EXPORTAR A PDF</button>
</div>

</div>

<!-- CANTIDAD DE VISITAS -->
<div *ngIf="seccionActiva === 'visitas'" class="seccion">
  <div class="visitas-container">
    <div class="visitas-card">
      <h3>üìä Resumen de Visitas a la Cl√≠nica</h3>
      <div class="visitas-numero">
        <span class="numero-grande">{{ totalVisitas }}</span>
        <span class="label">Total de Visitas</span>
      </div>
      <p class="descripcion">Esta es la cantidad total de ingresos registrados en el sistema.</p>
    </div>
  </div>
</div>

<!-- PACIENTES POR ESPECIALIDAD -->
<div *ngIf="seccionActiva === 'pacientes-esp'" class="seccion">
  <div class="grafico-contenedor" *ngIf="pacientesPorEspecialidad.length > 0">
    <canvas id="graficoPacientesPorEspecialidad"></canvas>
  </div>
  <div class="mensaje-vacio" *ngIf="pacientesPorEspecialidad.length === 0">
    No hay datos disponibles.
  </div>
  <div class="exportar" *ngIf="pacientesPorEspecialidad.length > 0">
    <button (click)="descargarImagenPacientesPorEspecialidad()">üì• DESCARGAR IMAGEN DEL GR√ÅFICO</button>
  </div>
</div>

<!-- M√âDICOS POR ESPECIALIDAD -->
<div *ngIf="seccionActiva === 'medicos-esp'" class="seccion">
  <div class="grafico-contenedor" *ngIf="medicosPorEspecialidad.length > 0">
    <canvas id="graficoMedicosPorEspecialidad"></canvas>
  </div>
  <div class="mensaje-vacio" *ngIf="medicosPorEspecialidad.length === 0">
    No hay datos disponibles.
  </div>
  <div class="exportar" *ngIf="medicosPorEspecialidad.length > 0">
    <button (click)="descargarImagenMedicosPorEspecialidad()">üì• DESCARGAR IMAGEN DEL GR√ÅFICO</button>
  </div>
</div>

<!-- ENCUESTAS DE SATISFACCI√ìN -->
<div *ngIf="seccionActiva === 'encuestas'" class="seccion">
  <div class="encuestas-header">
    <h3>üìã Informe de Encuestas de Satisfacci√≥n</h3>
    <button class="btn-exportar-excel" (click)="exportarEncuestasAExcel()">üìä EXPORTAR A EXCEL</button>
  </div>
  
  <div class="encuestas-container" *ngIf="encuestas.length > 0">
    <div class="encuesta-card" *ngFor="let encuesta of encuestas">
      <div class="encuesta-header">
        <p><strong>Fecha:</strong> {{ encuesta.fecha | date:'dd/MM/yyyy' }}</p>
        <p><strong>Especialidad:</strong> {{ encuesta.especialidad }}</p>
        <p><strong>Especialista:</strong> {{ getNombreEspecialista(encuesta.especialista) }}</p>
      </div>
      <div class="encuesta-body" *ngIf="encuesta.encuesta">
        <div class="encuesta-item">
          <strong>‚≠ê Calificaci√≥n:</strong> {{ encuesta.encuesta.calificacionEstrellas }}/5 estrellas
        </div>
        <div class="encuesta-item">
          <strong>üëç Recomendaci√≥n:</strong> {{ encuesta.encuesta.recomendacion }}
        </div>
        <div class="encuesta-item">
          <strong>üìä Satisfacci√≥n General:</strong> {{ encuesta.encuesta.satisfaccionGeneral }}%
        </div>
        <div class="encuesta-item" *ngIf="encuesta.encuesta.aspectos">
          <strong>‚ú® Aspectos Destacados:</strong>
          <ul>
            <li *ngIf="encuesta.encuesta.aspectos.puntualidad">Puntualidad</li>
            <li *ngIf="encuesta.encuesta.aspectos.profesionalismo">Profesionalismo</li>
            <li *ngIf="encuesta.encuesta.aspectos.amabilidad">Amabilidad</li>
            <li *ngIf="encuesta.encuesta.aspectos.instalaciones">Instalaciones</li>
            <li *ngIf="encuesta.encuesta.aspectos.tiempoEspera">Tiempo de Espera</li>
          </ul>
        </div>
        <div class="encuesta-item" *ngIf="encuesta.encuesta.comentarios">
          <strong>üí¨ Comentarios:</strong> {{ encuesta.encuesta.comentarios }}
        </div>
      </div>
    </div>
  </div>
  <div class="mensaje-vacio" *ngIf="encuestas.length === 0">
    No hay encuestas registradas.
  </div>
</div>

<!-- TURNOS POR PACIENTE -->
<div *ngIf="seccionActiva === 'turnos-paciente'" class="seccion">
  <div class="selector-paciente">
    <label>
      <strong>Seleccionar Paciente:</strong>
      <select [(ngModel)]="pacienteSeleccionado" (change)="cargarTurnosDelPaciente()">
        <option value="">-- Seleccione un paciente --</option>
        <option *ngFor="let paciente of pacientes" [value]="paciente.id">
          {{ paciente.nombre }} {{ paciente.apellido }} ({{ paciente.mail }})
        </option>
      </select>
    </label>
  </div>

  <div *ngIf="pacienteSeleccionado && turnosDelPaciente.length > 0" class="turnos-paciente-container">
    <div class="turnos-paciente-header">
      <h3>üìã Turnos de {{ getNombrePaciente(pacienteSeleccionado) }}</h3>
      <button class="btn-exportar-excel" (click)="exportarTurnosPacienteAExcel()">üìä EXPORTAR A EXCEL</button>
    </div>
    
    <div class="turnos-paciente-grid">
      <div class="turno-paciente-card" *ngFor="let turno of turnosDelPaciente" [ngClass]="'estado-' + turno.estado">
        <p><strong>Fecha:</strong> {{ turno.fecha | date:'dd/MM/yyyy' }}</p>
        <p><strong>Hora:</strong> {{ turno.hora }}</p>
        <p><strong>Especialidad:</strong> {{ turno.especialidad }}</p>
        <p><strong>Especialista:</strong> {{ getNombreEspecialista(turno.especialista) }}</p>
        <p><strong>Estado:</strong> <span class="estado-badge">{{ turno.estado | uppercase }}</span></p>
        <p *ngIf="turno.motivo_cancelacion"><strong>Motivo Cancelaci√≥n:</strong> {{ turno.motivo_cancelacion }}</p>
        <p *ngIf="turno.motivo_rechazo"><strong>Motivo Rechazo:</strong> {{ turno.motivo_rechazo }}</p>
        <p *ngIf="turno.comentarioEspecialista"><strong>Comentario Especialista:</strong> {{ turno.comentarioEspecialista }}</p>
        <p *ngIf="turno.calificacionPaciente"><strong>Calificaci√≥n:</strong> {{ turno.calificacionPaciente }}</p>
      </div>
    </div>
  </div>

  <div class="mensaje-vacio" *ngIf="pacienteSeleccionado && turnosDelPaciente.length === 0">
    Este paciente no tiene turnos registrados.
  </div>
</div>
